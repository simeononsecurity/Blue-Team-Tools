#!/bin/bash
###############################################################################
#
# Bash Remediation Script for Open Computing Information Security Profile for OpenShift Node
#
# Profile Description:
# This baseline was inspired by the Center for Internet Security
# (CIS) Kubernetes Benchmark, v1.2.0 - 01-31-2017.
# For the ComplianceAsCode project to remain in compliance with
# CIS' terms and conditions, specifically Restrictions(8), note
# there is no representation or claim that the OpenCIS profile will
# ensure a system is in compliance or consistency with the CIS
# baseline.
#
# Profile ID:  opencis-node
# Benchmark ID:  OCP-3
# Benchmark Version:  0.1.52
# XCCDF Version:  1.1
#
# This file was generated by OpenSCAP 1.3.3 using:
# $ oscap xccdf generate fix --profile opencis-node --fix-type bash xccdf-file.xml
#
# This Bash Remediation Script is generated from an OpenSCAP profile without preliminary evaluation.
# It attempts to fix every selected rule, even if the system is already compliant.
#
# How to apply this Bash Remediation Script:
# $ sudo ./remediation-script.sh
#
###############################################################################

###############################################################################
# BEGIN fix (1 / 20) for 'kubelet_configure_client_ca'
###############################################################################
(>&2 echo "Remediating rule 1/20: 'kubelet_configure_client_ca'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_configure_client_ca' IS MISSING!")

# END fix for 'kubelet_configure_client_ca'

###############################################################################
# BEGIN fix (2 / 20) for 'kubelet_configure_tls_cert'
###############################################################################
(>&2 echo "Remediating rule 2/20: 'kubelet_configure_tls_cert'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_configure_tls_cert' IS MISSING!")

# END fix for 'kubelet_configure_tls_cert'

###############################################################################
# BEGIN fix (3 / 20) for 'kubelet_enable_iptables_util_chains'
###############################################################################
(>&2 echo "Remediating rule 3/20: 'kubelet_enable_iptables_util_chains'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_enable_iptables_util_chains' IS MISSING!")

# END fix for 'kubelet_enable_iptables_util_chains'

###############################################################################
# BEGIN fix (4 / 20) for 'kubelet_enable_streaming_connections'
###############################################################################
(>&2 echo "Remediating rule 4/20: 'kubelet_enable_streaming_connections'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_enable_streaming_connections' IS MISSING!")

# END fix for 'kubelet_enable_streaming_connections'

###############################################################################
# BEGIN fix (5 / 20) for 'kubelet_enable_client_cert_rotation'
###############################################################################
(>&2 echo "Remediating rule 5/20: 'kubelet_enable_client_cert_rotation'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_enable_client_cert_rotation' IS MISSING!")

# END fix for 'kubelet_enable_client_cert_rotation'

###############################################################################
# BEGIN fix (6 / 20) for 'kubelet_disable_readonly_port'
###############################################################################
(>&2 echo "Remediating rule 6/20: 'kubelet_disable_readonly_port'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_disable_readonly_port' IS MISSING!")

# END fix for 'kubelet_disable_readonly_port'

###############################################################################
# BEGIN fix (7 / 20) for 'kubelet_disable_cadvisor_port'
###############################################################################
(>&2 echo "Remediating rule 7/20: 'kubelet_disable_cadvisor_port'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_disable_cadvisor_port' IS MISSING!")

# END fix for 'kubelet_disable_cadvisor_port'

###############################################################################
# BEGIN fix (8 / 20) for 'kubelet_configure_tls_key'
###############################################################################
(>&2 echo "Remediating rule 8/20: 'kubelet_configure_tls_key'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_configure_tls_key' IS MISSING!")

# END fix for 'kubelet_configure_tls_key'

###############################################################################
# BEGIN fix (9 / 20) for 'kubelet_enable_server_cert_rotation'
###############################################################################
(>&2 echo "Remediating rule 9/20: 'kubelet_enable_server_cert_rotation'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_enable_server_cert_rotation' IS MISSING!")

# END fix for 'kubelet_enable_server_cert_rotation'

###############################################################################
# BEGIN fix (10 / 20) for 'kubelet_configure_event_creation'
###############################################################################
(>&2 echo "Remediating rule 10/20: 'kubelet_configure_event_creation'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_configure_event_creation' IS MISSING!")

# END fix for 'kubelet_configure_event_creation'

###############################################################################
# BEGIN fix (11 / 20) for 'kubelet_disable_hostname_override'
###############################################################################
(>&2 echo "Remediating rule 11/20: 'kubelet_disable_hostname_override'")
(>&2 echo "FIX FOR THIS RULE 'kubelet_disable_hostname_override' IS MISSING!")

# END fix for 'kubelet_disable_hostname_override'

###############################################################################
# BEGIN fix (12 / 20) for 'file_permissions_openshift_node_service'
###############################################################################
(>&2 echo "Remediating rule 12/20: 'file_permissions_openshift_node_service'")


chmod 0644 /etc/systemd/system/atomic-openshift-node.service

# END fix for 'file_permissions_openshift_node_service'

###############################################################################
# BEGIN fix (13 / 20) for 'file_permissions_openshift_node_client_crt'
###############################################################################
(>&2 echo "Remediating rule 13/20: 'file_permissions_openshift_node_client_crt'")


chmod 0644 /etc/origin/node/client-ca.crt

# END fix for 'file_permissions_openshift_node_client_crt'

###############################################################################
# BEGIN fix (14 / 20) for 'file_owner_openshift_node_service'
###############################################################################
(>&2 echo "Remediating rule 14/20: 'file_owner_openshift_node_service'")


chown 0 /etc/systemd/system/atomic-openshift-node.service

# END fix for 'file_owner_openshift_node_service'

###############################################################################
# BEGIN fix (15 / 20) for 'file_owner_node_config'
###############################################################################
(>&2 echo "Remediating rule 15/20: 'file_owner_node_config'")


chown 0 /etc/origin/node/node-config.yaml

# END fix for 'file_owner_node_config'

###############################################################################
# BEGIN fix (16 / 20) for 'file_owner_openshift_node_client_crt'
###############################################################################
(>&2 echo "Remediating rule 16/20: 'file_owner_openshift_node_client_crt'")


chown 0 /etc/origin/node/client-ca.crt

# END fix for 'file_owner_openshift_node_client_crt'

###############################################################################
# BEGIN fix (17 / 20) for 'file_groupowner_node_config'
###############################################################################
(>&2 echo "Remediating rule 17/20: 'file_groupowner_node_config'")


chgrp 0 /etc/origin/node/node-config.yaml

# END fix for 'file_groupowner_node_config'

###############################################################################
# BEGIN fix (18 / 20) for 'file_permissions_node_config'
###############################################################################
(>&2 echo "Remediating rule 18/20: 'file_permissions_node_config'")


chmod 0600 /etc/origin/node/node-config.yaml

# END fix for 'file_permissions_node_config'

###############################################################################
# BEGIN fix (19 / 20) for 'file_groupowner_openshift_node_client_crt'
###############################################################################
(>&2 echo "Remediating rule 19/20: 'file_groupowner_openshift_node_client_crt'")


chgrp 0 /etc/origin/node/client-ca.crt

# END fix for 'file_groupowner_openshift_node_client_crt'

###############################################################################
# BEGIN fix (20 / 20) for 'file_groupowner_openshift_node_service'
###############################################################################
(>&2 echo "Remediating rule 20/20: 'file_groupowner_openshift_node_service'")


chgrp 0 /etc/systemd/system/atomic-openshift-node.service

# END fix for 'file_groupowner_openshift_node_service'

